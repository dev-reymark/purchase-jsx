import{R as C,r as v,j as e,Y as S,b as w}from"./app-DZe3A5Eo.js";import{d as j}from"./index-D_IJPO7K.js";import{S as f}from"./sweetalert2.all-U6Xlt3MP.js";import{A as D}from"./AuthenticatedLayout-BJkFj0yU.js";import{c as q,D as E}from"./Icons-C6XQLy4H.js";import{d as F}from"./useMenuTriggerState-CYspXe38.js";import{i as u}from"./chunk-ZH5EUE66-B37RNOwp.js";import{s as I,l as T}from"./chunk-OKTOLZE5-BM3pR4xK.js";import{t as O,a as R,b as c,c as A,d as B,e as d}from"./chunk-YRZGWF2W-BTdUnALr.js";import{b as _}from"./chunk-NXTXE2B3-H9fbYrcq.js";import"./ApplicationLogo-sVjwoLkn.js";import"./chunk-YAC6J4IU-BjIZhijt.js";import"./index-DF1axCFp.js";import"./chunk-XHQUSKIE-Cm8YodC9.js";import"./VisuallyHidden-oXn3kJb5.js";import"./chunk-6SYPMUJF-DKWkzE0F.js";import"./Combination-DUOysM2-.js";import"./useControlledState-CjXxMMAQ.js";import"./chunk-RXDYTPX4-aYd7C-dW.js";import"./chunk-7F3ZLNJ6-Cd56nhL-.js";import"./chunk-HUKVTWEI-ClycOMCv.js";import"./useToggleState-BDjIqUK2.js";import"./chunk-RFUEKIFS-BiXG_wtu.js";const V=(n,m)=>n.length>m?n.substring(0,m)+"...":n,ce=({reference:n,currentUser:m,products:x,auth:b})=>{const[r,o]=C.useState({reference:n,buyer:m.name,email:m.email,total:0,status:"pending",vendor:"Datalogic Systems Corporation",selectedProduct:[],products:[]});v.useEffect(()=>{o(t=>({...t,reference:n}))},[n]),v.useEffect(()=>{const t=r.products.reduce((s,a)=>s+a.quantity*a.unitPrice,0);o(s=>({...s,total:t}))},[r.products]);const h=t=>{const{name:s,value:a}=t.target;o(i=>({...i,[s]:a}))},y=t=>{const s=parseInt(t.target.value),a=x.find(i=>i.id===s);if(a){const i=[...r.products,{id:a.id,name:a.name,price:a.price,description:a.description,quantity:1,unitPrice:a.price,is_vat_exempt:a.is_vat_exempt==="1",vat_rate:a.is_vat_exempt==="0"?a.vat_rate:0}];o(l=>({...l,products:i}))}},g=(t,s)=>{const a=r.products.map(i=>i.id===t?{...i,quantity:s}:i);o(i=>({...i,products:a}))},P=t=>{const s=r.products.filter(a=>a.id!==t);o(a=>({...a,products:s}))},N=async t=>{t.preventDefault();try{const s=await w.post("/purchases",r),a=await f.fire({title:"Success!",text:"Purchase order created successfully",icon:"success",showCancelButton:!0,confirmButtonText:"Pay Now",cancelButtonText:"Close"}),i=r.total+r.products.filter(l=>!l.is_vat_exempt).reduce((l,p)=>l+p.unitPrice*p.quantity*(p.vat_rate/100),0);if(a.isConfirmed){const l=JSON.stringify(r.products);j.Inertia.visit(route("payments.create",{total:i,reference:r.reference,products:l}))}else a.dismiss===f.DismissReason.cancel&&j.Inertia.visit(route("purchases.index"))}catch{f.fire("Error!","Failed to create purchase order","error")}};return e.jsxs(D,{user:b.user,header:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Create Purchase Order"})}),children:[e.jsx(S,{title:"Create Purchase Order"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"sm:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-xl mx-auto p-4 bg-white shadow-md rounded-lg py-5",children:e.jsxs("form",{onSubmit:N,children:[e.jsx("div",{className:"mb-4",children:e.jsx(u,{label:"Reference",type:"text",name:"reference",value:r.reference,onChange:h,readOnly:!0})}),e.jsx("div",{className:"mb-4",children:e.jsx(u,{label:"Buyer",type:"text",name:"buyer",value:r.buyer,onChange:h})}),e.jsx("div",{className:"mb-4",children:e.jsx(u,{label:"Email",type:"text",name:"email",value:r.email,onChange:h})}),e.jsx("div",{className:"mb-4",children:e.jsx(u,{label:"Vendor",type:"text",name:"vendor",value:r.vendor,onChange:h,readOnly:!0})}),e.jsx("div",{className:"mb-4",children:e.jsx(I,{label:"Select Product",name:"selectedProduct",onChange:y,children:x&&x.length>0&&x.map(t=>e.jsx(T,{value:t.id,children:t.name},t.id))})}),e.jsx("div",{className:"mb-8",children:e.jsxs(O,{"aria-label":"Selected Products",children:[e.jsxs(R,{children:[e.jsx(c,{children:"Product"}),e.jsx(c,{children:"Price"}),e.jsx(c,{children:"Description"}),e.jsx(c,{children:"Quantity"}),e.jsx(c,{children:"Taxes"}),e.jsx(c,{children:"Subtotal"}),e.jsx(c,{})]}),e.jsx(A,{children:r.products.map(t=>e.jsxs(B,{children:[e.jsx(d,{children:t.name}),e.jsxs(d,{children:["₱",t.price]}),e.jsx(d,{children:V(t.description,10)}),e.jsx(d,{children:e.jsx(u,{size:"sm",type:"number",value:t.quantity,onChange:s=>g(t.id,parseInt(s.target.value)),className:"w-12"})}),e.jsx(d,{children:e.jsx(q,{color:"success",size:"sm",children:t.is_vat_exempt?"VAT Exempted":`${t.vat_rate}%`})}),e.jsx(d,{children:t.is_vat_exempt?`₱${(t.unitPrice*t.quantity).toFixed(2)}`:`₱${(t.unitPrice*t.quantity*(1+t.vat_rate/100)).toFixed(2)}`}),e.jsx(d,{children:e.jsx(E,{onClick:()=>P(t.id),className:"text-danger cursor-pointer"})})]},t.id))})]})}),e.jsx(F,{className:"my-4"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-bold",children:["Untaxed Amount:"," "]}),e.jsxs("span",{children:["₱",r.total.toFixed(2)]})]}),r.products.some(t=>!t.is_vat_exempt)&&e.jsxs("div",{children:[e.jsxs("span",{className:"font-bold",children:["VAT % :"," "]}),e.jsxs("span",{children:["₱",r.products.filter(t=>!t.is_vat_exempt).reduce((t,s)=>t+s.unitPrice*s.quantity*(s.vat_rate/100),0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Total: "}),e.jsxs("span",{children:["₱",r.total+r.products.filter(t=>!t.is_vat_exempt).reduce((t,s)=>t+s.unitPrice*s.quantity*(s.vat_rate/100),0),".00"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mb-4",children:[e.jsx(_,{type:"submit",color:"primary",children:"Create"}),e.jsx(_,{color:"danger",onClick:()=>j.Inertia.visit(route("purchases.index")),children:"Cancel"})]})]})})})})]})};export{ce as default};
